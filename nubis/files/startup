#!/bin/bash -l

exec &> >(tee /var/log/startup.log) 2>&1

if test -f /sys/kernel/mm/transparent_hugepage/enabled; then
    echo "Enable Transparent Hugepages"
    echo always > /sys/kernel/mm/transparent_hugepage/enabled
fi

# Handling some swap
SWAP_SIZE_MEG=4196
SWAP_FILE=/var/swap

echo "Making $SWAP_SIZE_MEG Mb of swap in $SWAP_FILE"
dd if=/dev/zero of=$SWAP_FILE bs="1M" count="$SWAP_SIZE_MEG"
chmod 600 $SWAP_FILE
mkswap $SWAP_FILE
swapon $SWAP_FILE
